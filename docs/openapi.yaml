openapi: 3.0.3
info:
  title: OttoChain Bridge API
  description: |
    Transaction signing, wallet management, and convenience routes for OttoChain metagraph.
    
    ## Architecture
    The Bridge provides a REST API layer on top of the generic metagraph. It handles:
    - Wallet generation and key management
    - Transaction signing and submission
    - Convenience routes for common app patterns (Identity, Contracts, Markets, DAOs)
    - Generic routes for arbitrary state machine definitions
    
    ## App Routes vs Generic Routes
    | Type | Routes | Description |
    |------|--------|-------------|
    | **App** | `/agent`, `/contract`, `/corporate`, `/governance`, `/market` | Pre-built definitions for common use cases |
    | **Generic** | `/fiber`, `/sm`, `/script` | Accept any valid state machine definition |
    
  version: 1.0.0
  contact:
    name: OttoChain
    url: https://github.com/ottobot-ai/ottochain-services
  license:
    name: Apache-2.0

servers:
  - url: http://localhost:3030
    description: Local Bridge

tags:
  - name: Wallet
    description: Wallet generation and management
  - name: Agent
    description: Agent Identity management
  - name: Contract
    description: Contract workflows
  - name: Market
    description: Markets (predictions, auctions, crowdfunding, group buys)
  - name: Corporate
    description: Corporate governance (entities, board, shareholders, officers, securities, compliance)
  - name: Governance
    description: DAO and governance operations
  - name: Fiber
    description: Generic fiber/state machine operations
  - name: Script
    description: Script oracle operations

paths:
  # ===== Health =====
  /health:
    get:
      summary: Health check
      operationId: getHealth
      responses:
        '200':
          description: Service healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: bridge

  # ===== Wallet =====
  /wallet/generate:
    post:
      tags: [Wallet]
      summary: Generate new wallet
      operationId: generateWallet
      responses:
        '200':
          description: New wallet generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wallet'

  # ===== Agent Identity =====
  /agent/wallet:
    post:
      tags: [Agent]
      summary: Generate wallet for agent
      operationId: generateAgentWallet
      responses:
        '200':
          description: Wallet generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wallet'

  /agent/register:
    post:
      tags: [Agent]
      summary: Register new agent identity
      operationId: registerAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterAgentRequest'
      responses:
        '201':
          description: Agent registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRegistrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /agent/activate:
    post:
      tags: [Agent]
      summary: Activate an agent
      operationId: activateAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, fiberId]
              properties:
                privateKey:
                  type: string
                fiberId:
                  type: string
                  format: uuid
                waitForSync:
                  type: boolean
                  default: true
                maxWaitSeconds:
                  type: integer
                  default: 30
      responses:
        '200':
          description: Agent activated
        '404':
          description: Agent not found
        '503':
          description: Fiber not yet synced

  /agent/transition:
    post:
      tags: [Agent]
      summary: Transition agent state
      operationId: transitionAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitionRequest'
      responses:
        '200':
          description: Transition successful
        '404':
          description: Agent not found

  /agent/vouch:
    post:
      tags: [Agent]
      summary: Vouch for another agent
      operationId: vouchForAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, targetFiberId]
              properties:
                privateKey:
                  type: string
                targetFiberId:
                  type: string
                  format: uuid
                fromAddress:
                  type: string
                reason:
                  type: string
      responses:
        '200':
          description: Vouch recorded

  /agent/{fiberId}:
    get:
      tags: [Agent]
      summary: Get agent by fiber ID
      operationId: getAgent
      parameters:
        - name: fiberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Agent state
        '404':
          description: Agent not found

  /agent:
    get:
      tags: [Agent]
      summary: List all agents
      operationId: listAgents
      responses:
        '200':
          description: Agent list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  agents:
                    type: object
                    additionalProperties:
                      type: object

  # ===== Contracts =====
  /contract/propose:
    post:
      tags: [Contract]
      summary: Propose a new contract
      operationId: proposeContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProposeContractRequest'
      responses:
        '201':
          description: Contract proposed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractProposedResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /contract/accept:
    post:
      tags: [Contract]
      summary: Accept a proposed contract (counterparty only)
      operationId: acceptContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractActionRequest'
      responses:
        '200':
          description: Contract accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractActionResponse'
        '400':
          description: Contract not in Proposed state
        '403':
          description: Only counterparty can accept
        '404':
          description: Contract not found

  /contract/reject:
    post:
      tags: [Contract]
      summary: Reject a proposed contract (counterparty only)
      operationId: rejectContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractActionRequest'
      responses:
        '200':
          description: Contract rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractActionResponse'
        '400':
          description: Contract not in Proposed state
        '404':
          description: Contract not found

  /contract/complete:
    post:
      tags: [Contract]
      summary: Submit completion proof (either party)
      operationId: completeContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractActionRequest'
      responses:
        '200':
          description: Completion recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  hash:
                    type: string
                  contractId:
                    type: string
                    format: uuid
                  message:
                    type: string
                    example: Completion recorded. Both parties must complete to finalize.
        '400':
          description: Contract not Active
        '404':
          description: Contract not found

  /contract/finalize:
    post:
      tags: [Contract]
      summary: Finalize contract after both parties complete
      operationId: finalizeContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractActionRequest'
      responses:
        '200':
          description: Contract finalized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractActionResponse'
        '400':
          description: Both parties must submit completion first
        '404':
          description: Contract not found

  /contract/dispute:
    post:
      tags: [Contract]
      summary: Dispute an active contract
      operationId: disputeContract
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/ContractActionRequest'
                - type: object
                  required: [reason]
                  properties:
                    reason:
                      type: string
                      description: Reason for dispute (required)
      responses:
        '200':
          description: Dispute filed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractActionResponse'
        '400':
          description: Can only dispute Active contracts or missing reason
        '404':
          description: Contract not found

  /contract/{contractId}:
    get:
      tags: [Contract]
      summary: Get contract by ID
      operationId: getContract
      parameters:
        - name: contractId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Contract state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractState'
        '404':
          description: Contract not found

  /contract:
    get:
      tags: [Contract]
      summary: List all contracts
      operationId: listContracts
      responses:
        '200':
          description: Contract list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  contracts:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/ContractState'

  # ===== Markets =====
  /market/create:
    post:
      tags: [Market]
      summary: Create a new market
      operationId: createMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMarketRequest'
      responses:
        '201':
          description: Market created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketCreatedResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /market/open:
    post:
      tags: [Market]
      summary: Open market for commitments
      operationId: openMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Market opened
        '400':
          description: Cannot open (wrong state)
        '404':
          description: Market not found

  /market/commit:
    post:
      tags: [Market]
      summary: Commit to a market (stake/bid/pledge)
      operationId: commitToMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MarketCommitRequest'
      responses:
        '200':
          description: Commitment recorded
        '400':
          description: Market not open
        '404':
          description: Market not found

  /market/close:
    post:
      tags: [Market]
      summary: Close market for new commitments
      operationId: closeMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Market closed

  /market/resolve:
    post:
      tags: [Market]
      summary: Submit resolution (oracle)
      operationId: resolveMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MarketResolveRequest'
      responses:
        '200':
          description: Resolution submitted

  /market/finalize:
    post:
      tags: [Market]
      summary: Finalize market after quorum
      operationId: finalizeMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId, outcome]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
                outcome:
                  type: string
                settlement:
                  type: object
      responses:
        '200':
          description: Market finalized

  /market/claim:
    post:
      tags: [Market]
      summary: Claim winnings from settled market
      operationId: claimFromMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
                amount:
                  type: number
      responses:
        '200':
          description: Claim successful
        '400':
          description: Already claimed or no commitment

  /market/refund:
    post:
      tags: [Market]
      summary: Refund market (threshold not met)
      operationId: refundMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
                reason:
                  type: string
      responses:
        '200':
          description: Market refunded

  /market/cancel:
    post:
      tags: [Market]
      summary: Cancel market (before opening)
      operationId: cancelMarket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, marketId]
              properties:
                privateKey:
                  type: string
                marketId:
                  type: string
                  format: uuid
                reason:
                  type: string
      responses:
        '200':
          description: Market cancelled

  /market/{marketId}:
    get:
      tags: [Market]
      summary: Get market by ID
      operationId: getMarket
      parameters:
        - name: marketId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Market state
        '404':
          description: Market not found

  /market:
    get:
      tags: [Market]
      summary: List markets
      operationId: listMarkets
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PROPOSED, OPEN, CLOSED, RESOLVING, SETTLED, REFUNDED, CANCELLED]
        - name: marketType
          in: query
          schema:
            type: string
            enum: [prediction, auction, crowdfund, group_buy]
      responses:
        '200':
          description: Market list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  markets:
                    type: object

  # ===== Governance =====
  /governance/create-dao:
    post:
      tags: [Governance]
      summary: Create a DAO
      operationId: createDAO
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDAORequest'
      responses:
        '201':
          description: DAO created

  /governance/propose:
    post:
      tags: [Governance]
      summary: Create proposal
      operationId: propose
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProposeRequest'
      responses:
        '200':
          description: Proposal created

  /governance/vote:
    post:
      tags: [Governance]
      summary: Vote on proposal
      operationId: vote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        '200':
          description: Vote recorded

  /governance/execute:
    post:
      tags: [Governance]
      summary: Execute passed proposal
      operationId: executeProposal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, daoId]
              properties:
                privateKey:
                  type: string
                daoId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Proposal executed

  /governance/delegate:
    post:
      tags: [Governance]
      summary: Delegate voting power
      operationId: delegate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, daoId, delegateTo]
              properties:
                privateKey:
                  type: string
                daoId:
                  type: string
                  format: uuid
                delegateTo:
                  type: string
                weight:
                  type: integer
      responses:
        '200':
          description: Delegation recorded

  /governance/veto:
    post:
      tags: [Governance]
      summary: Veto a proposal
      operationId: veto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, daoId, reason]
              properties:
                privateKey:
                  type: string
                daoId:
                  type: string
                  format: uuid
                reason:
                  type: string
      responses:
        '200':
          description: Veto recorded

  /governance/{daoId}:
    get:
      tags: [Governance]
      summary: Get DAO state
      operationId: getDAO
      parameters:
        - name: daoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: DAO state
        '404':
          description: DAO not found

  /governance/{daoId}/proposals:
    get:
      tags: [Governance]
      summary: List DAO proposals
      operationId: listProposals
      parameters:
        - name: daoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Proposal list

  /governance:
    get:
      tags: [Governance]
      summary: List all DAOs
      operationId: listDAOs
      parameters:
        - name: daoType
          in: query
          schema:
            type: string
            enum: [Single, Multisig, Threshold, Token]
      responses:
        '200':
          description: DAO list

  # ===== Corporate Governance =====
  /corporate/incorporate:
    post:
      tags: [Corporate]
      summary: Form a new corporate entity
      operationId: incorporate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IncorporateRequest'
      responses:
        '201':
          description: Entity incorporated

  /corporate/amend-charter:
    post:
      tags: [Corporate]
      summary: Amend corporate charter
      operationId: amendCharter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AmendCharterRequest'
      responses:
        '200':
          description: Charter amended

  /corporate/{entityId}:
    get:
      tags: [Corporate]
      summary: Get corporate entity details
      operationId: getCorporateEntity
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Entity details

  /corporate/{entityId}/board/elect:
    post:
      tags: [Corporate]
      summary: Elect director to board
      operationId: electDirector
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ElectDirectorRequest'
      responses:
        '200':
          description: Director elected

  /corporate/{entityId}/board/meeting:
    post:
      tags: [Corporate]
      summary: Manage board meeting (call, open, adjourn, record attendance)
      operationId: boardMeeting
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoardMeetingRequest'
      responses:
        '200':
          description: Meeting action completed

  /corporate/{entityId}/board/resolution:
    post:
      tags: [Corporate]
      summary: Submit board resolution
      operationId: boardResolution
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoardResolutionRequest'
      responses:
        '200':
          description: Resolution submitted

  /corporate/{entityId}/board/consent:
    post:
      tags: [Corporate]
      summary: Vote on board resolution (approve/reject/abstain)
      operationId: boardConsent
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, resolutionId, vote]
              properties:
                privateKey:
                  type: string
                resolutionId:
                  type: string
                  format: uuid
                vote:
                  type: string
                  enum: [approve, reject, abstain]
                comment:
                  type: string
      responses:
        '200':
          description: Vote recorded

  /corporate/{entityId}/shareholders/meeting:
    post:
      tags: [Corporate]
      summary: Manage shareholder meeting
      operationId: shareholderMeeting
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShareholderMeetingRequest'
      responses:
        '200':
          description: Meeting action completed

  /corporate/{entityId}/shareholders/vote:
    post:
      tags: [Corporate]
      summary: Shareholder vote
      operationId: shareholderVote
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, proposalId, vote, shares]
              properties:
                privateKey:
                  type: string
                proposalId:
                  type: string
                  format: uuid
                vote:
                  type: string
                  enum: [for, against, abstain]
                shares:
                  type: integer
      responses:
        '200':
          description: Vote recorded

  /corporate/{entityId}/shareholders/proxy:
    post:
      tags: [Corporate]
      summary: Grant or revoke proxy voting rights
      operationId: shareholderProxy
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProxyRequest'
      responses:
        '200':
          description: Proxy action completed

  /corporate/{entityId}/officers/appoint:
    post:
      tags: [Corporate]
      summary: Appoint corporate officer
      operationId: appointOfficer
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointOfficerRequest'
      responses:
        '200':
          description: Officer appointed

  /corporate/{entityId}/officers/remove:
    post:
      tags: [Corporate]
      summary: Remove corporate officer
      operationId: removeOfficer
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, officerId, reason, resolutionRef]
              properties:
                privateKey:
                  type: string
                officerId:
                  type: string
                  format: uuid
                reason:
                  type: string
                resolutionRef:
                  type: string
                  format: uuid
                effectiveDate:
                  type: string
      responses:
        '200':
          description: Officer removed

  /corporate/{entityId}/securities/issue:
    post:
      tags: [Corporate]
      summary: Issue securities (shares)
      operationId: issueSecurities
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IssueSecuritiesRequest'
      responses:
        '200':
          description: Securities issued

  /corporate/{entityId}/securities/transfer:
    post:
      tags: [Corporate]
      summary: Transfer securities between holders
      operationId: transferSecurities
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferSecuritiesRequest'
      responses:
        '200':
          description: Securities transferred

  /corporate/{entityId}/compliance/file:
    post:
      tags: [Corporate]
      summary: File compliance document
      operationId: fileCompliance
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileComplianceRequest'
      responses:
        '200':
          description: Filing recorded

  /corporate/{entityId}/compliance:
    get:
      tags: [Corporate]
      summary: Get compliance history
      operationId: getCompliance
      parameters:
        - name: entityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Compliance records

  /corporate:
    get:
      tags: [Corporate]
      summary: List all corporate entities
      operationId: listCorporateEntities
      responses:
        '200':
          description: Entity list

  # ===== Generic Fiber =====
  /fiber/create:
    post:
      tags: [Fiber]
      summary: Create fiber with custom definition
      operationId: createFiber
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFiberRequest'
      responses:
        '201':
          description: Fiber created

  /fiber/transition:
    post:
      tags: [Fiber]
      summary: Transition fiber state
      operationId: transitionFiber
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitionRequest'
      responses:
        '200':
          description: Transition successful

  /fiber/batch:
    post:
      tags: [Fiber]
      summary: Batch fiber operations
      operationId: batchFiber
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                operations:
                  type: array
                  items:
                    type: object
      responses:
        '200':
          description: Batch processed

  # ===== Generic SM =====
  /sm/create:
    post:
      tags: [Fiber]
      summary: Create state machine (alias for /fiber/create)
      operationId: createSM
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFiberRequest'
      responses:
        '201':
          description: State machine created

  /sm/transition:
    post:
      tags: [Fiber]
      summary: Transition state machine
      operationId: transitionSM
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitionRequest'
      responses:
        '200':
          description: Transition successful

  /sm/{fiberId}:
    get:
      tags: [Fiber]
      summary: Get state machine by ID
      operationId: getSM
      parameters:
        - name: fiberId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: State machine state
        '404':
          description: Not found

  /sm:
    get:
      tags: [Fiber]
      summary: List state machines
      operationId: listSMs
      parameters:
        - name: schema
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
      responses:
        '200':
          description: State machine list

  # ===== Script Oracle =====
  /script/register:
    post:
      tags: [Script]
      summary: Register script oracle
      operationId: registerScript
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, script]
              properties:
                privateKey:
                  type: string
                script:
                  type: object
      responses:
        '201':
          description: Script registered

  /script/invoke:
    post:
      tags: [Script]
      summary: Invoke script oracle
      operationId: invokeScript
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [privateKey, scriptId, input]
              properties:
                privateKey:
                  type: string
                scriptId:
                  type: string
                  format: uuid
                input:
                  type: object
      responses:
        '200':
          description: Script invoked

  /script/{scriptId}:
    get:
      tags: [Script]
      summary: Get script state
      operationId: getScript
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Script state
        '404':
          description: Not found

  /script/{scriptId}/result:
    get:
      tags: [Script]
      summary: Get script result
      operationId: getScriptResult
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Script result

components:
  schemas:
    Wallet:
      type: object
      properties:
        privateKey:
          type: string
        publicKey:
          type: string
        address:
          type: string

    RegisterAgentRequest:
      type: object
      required: [privateKey]
      properties:
        privateKey:
          type: string
          minLength: 64
          maxLength: 64
        displayName:
          type: string
        platform:
          type: string
        platformUserId:
          type: string

    AgentRegistrationResponse:
      type: object
      properties:
        fiberId:
          type: string
          format: uuid
        address:
          type: string
        hash:
          type: string
        message:
          type: string

    TransitionRequest:
      type: object
      required: [privateKey, fiberId, event]
      properties:
        privateKey:
          type: string
        fiberId:
          type: string
          format: uuid
        event:
          type: string
        payload:
          type: object

    CreateMarketRequest:
      type: object
      required: [privateKey, marketType, title]
      properties:
        privateKey:
          type: string
        marketType:
          type: string
          enum: [prediction, auction, crowdfund, group_buy]
        title:
          type: string
        description:
          type: string
        deadline:
          type: string
          format: date-time
          nullable: true
        threshold:
          type: number
          nullable: true
        oracles:
          type: array
          items:
            type: string
        quorum:
          type: integer
          minimum: 1
          default: 1
        terms:
          type: object
          properties:
            question:
              type: string
            outcomes:
              type: array
              items:
                type: string
            feePercent:
              type: number
            item:
              type: string
            reservePrice:
              type: number
            buyNowPrice:
              type: number
              nullable: true
            goal:
              type: number
            rewards:
              type: array
              items:
                type: object
            allOrNothing:
              type: boolean
            product:
              type: string
            unitPrice:
              type: number
            bulkPrice:
              type: number
            minUnits:
              type: number

    MarketCreatedResponse:
      type: object
      properties:
        marketId:
          type: string
          format: uuid
        marketType:
          type: string
        creator:
          type: string
        hash:
          type: string
        message:
          type: string

    MarketCommitRequest:
      type: object
      required: [privateKey, marketId, amount]
      properties:
        privateKey:
          type: string
        marketId:
          type: string
          format: uuid
        amount:
          type: number
          minimum: 0
          exclusiveMinimum: true
        data:
          type: object
          description: Outcome choice, bid data, etc.

    MarketResolveRequest:
      type: object
      required: [privateKey, marketId, outcome]
      properties:
        privateKey:
          type: string
        marketId:
          type: string
          format: uuid
        outcome:
          type: string
        proof:
          type: string

    CreateDAORequest:
      type: object
      required: [privateKey, daoType, name]
      properties:
        privateKey:
          type: string
        daoType:
          type: string
          enum: [Single, Multisig, Threshold, Token]
        name:
          type: string
        description:
          type: string
        signers:
          type: array
          items:
            type: string
        threshold:
          type: integer
        tokenId:
          type: string
          format: uuid
        proposalThreshold:
          type: integer
        quorum:
          type: integer
        votingPeriodMs:
          type: integer
          default: 259200000
        timelockMs:
          type: integer
          default: 86400000
        passingThreshold:
          type: number
          minimum: 0
          maximum: 1
          default: 0.5
        admins:
          type: array
          items:
            type: string
        proposers:
          type: array
          items:
            type: string
        vetoers:
          type: array
          items:
            type: string

    ProposeRequest:
      type: object
      required: [privateKey, daoId, title]
      properties:
        privateKey:
          type: string
        daoId:
          type: string
          format: uuid
        proposalId:
          type: string
        title:
          type: string
        description:
          type: string
        actionType:
          type: string
        payload:
          type: object

    VoteRequest:
      type: object
      required: [privateKey, daoId, vote]
      properties:
        privateKey:
          type: string
        daoId:
          type: string
          format: uuid
        vote:
          type: string
          enum: [For, Against, Abstain]
        weight:
          type: integer

    CreateFiberRequest:
      type: object
      required: [privateKey, definition, initialData]
      properties:
        privateKey:
          type: string
        fiberId:
          type: string
          format: uuid
        definition:
          type: object
          description: State machine definition (states, transitions, etc.)
        initialData:
          type: object
          description: Initial state data
        parentFiberId:
          type: string
          format: uuid
          nullable: true

    # Contract Schemas
    ProposeContractRequest:
      type: object
      required: [privateKey, counterpartyAddress, terms]
      properties:
        privateKey:
          type: string
          minLength: 64
          maxLength: 64
          description: 64-char hex private key
        counterpartyAddress:
          type: string
          description: DAG address of the counterparty
        terms:
          type: object
          additionalProperties: true
          description: Contract terms (arbitrary JSON)
        title:
          type: string
          description: Optional contract title
        description:
          type: string
          description: Optional contract description

    ContractActionRequest:
      type: object
      required: [privateKey, contractId]
      properties:
        privateKey:
          type: string
          minLength: 64
          maxLength: 64
        contractId:
          type: string
          format: uuid
        proof:
          type: string
          description: Completion proof (for complete action)
        reason:
          type: string
          description: Reason for rejection/dispute

    ContractProposedResponse:
      type: object
      properties:
        contractId:
          type: string
          format: uuid
        proposer:
          type: string
          description: DAG address of proposer
        counterparty:
          type: string
          description: DAG address of counterparty
        hash:
          type: string
          description: Transaction hash
        message:
          type: string
          example: Contract proposed. Awaiting counterparty acceptance.

    ContractActionResponse:
      type: object
      properties:
        hash:
          type: string
          description: Transaction hash
        contractId:
          type: string
          format: uuid
        status:
          type: string
          enum: [Active, Rejected, Completed, Disputed]

    ContractState:
      type: object
      properties:
        fiberId:
          type: string
          format: uuid
        currentState:
          type: object
          properties:
            value:
              type: string
              enum: [PROPOSED, ACTIVE, COMPLETED, DISPUTED, REJECTED, CANCELLED]
        sequenceNumber:
          type: integer
        stateData:
          type: object
          properties:
            schema:
              type: string
              example: Contract
            title:
              type: string
            description:
              type: string
            proposer:
              type: string
            counterparty:
              type: string
            terms:
              type: object
            completions:
              type: array
              items:
                type: object
                properties:
                  agent:
                    type: string
                  proof:
                    type: string
                  submittedAt:
                    type: string
                    format: date-time
            status:
              type: string
            proposedAt:
              type: string
              format: date-time
            acceptedAt:
              type: string
              format: date-time
            completedAt:
              type: string
              format: date-time
            rejectedAt:
              type: string
              format: date-time
            disputedAt:
              type: string
              format: date-time


    # ===== Corporate Schemas =====
    IncorporateRequest:
      type: object
      required: [privateKey, legalName, entityType, jurisdiction, registeredAgent]
      properties:
        privateKey:
          type: string
        legalName:
          type: string
        entityType:
          type: string
          enum: [C_CORP, S_CORP, B_CORP, LLC, LP, LLP]
        jurisdiction:
          type: object
          required: [state]
          properties:
            state:
              type: string
              minLength: 2
              maxLength: 2
            country:
              type: string
              default: USA
        registeredAgent:
          type: object
          required: [name, address]
          properties:
            name:
              type: string
            address:
              type: object
              properties:
                street:
                  type: string
                city:
                  type: string
                state:
                  type: string
                zip:
                  type: string
        authorizedShares:
          type: array
          items:
            type: object
            properties:
              className:
                type: string
              authorized:
                type: integer
              parValue:
                type: number
        initialDirectors:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              address:
                type: string
        purpose:
          type: string
        fiscalYearEnd:
          type: string

    AmendCharterRequest:
      type: object
      required: [privateKey, entityId, amendmentType, description, resolutionRef, effectiveDate]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        amendmentType:
          type: string
          enum: [NAME_CHANGE, SHARE_AUTHORIZATION, PURPOSE_CHANGE, OTHER]
        description:
          type: string
        resolutionRef:
          type: string
          format: uuid
        effectiveDate:
          type: string
        newLegalName:
          type: string
        newShareAuthorization:
          type: object
          properties:
            className:
              type: string
            newAuthorized:
              type: integer

    ElectDirectorRequest:
      type: object
      required: [privateKey, entityId, name, termStart, termEnd, electionResolutionRef]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        termStart:
          type: string
        termEnd:
          type: string
        class:
          type: string
          enum: [CLASS_I, CLASS_II, CLASS_III, UNCLASSIFIED]
        isIndependent:
          type: boolean
        electionResolutionRef:
          type: string
          format: uuid

    BoardMeetingRequest:
      type: object
      required: [privateKey, entityId, action]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        action:
          type: string
          enum: [call, open, adjourn, record_attendance]
        meetingType:
          type: string
          enum: [REGULAR, SPECIAL, ANNUAL, ORGANIZATIONAL]
        scheduledDate:
          type: string
        location:
          type: string
        isVirtual:
          type: boolean
        agenda:
          type: array
          items:
            type: string

    BoardResolutionRequest:
      type: object
      required: [privateKey, entityId, title, category, resolvedText]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        title:
          type: string
        category:
          type: string
          enum: [OFFICER_APPOINTMENT, OFFICER_REMOVAL, STOCK_ISSUANCE, DIVIDEND_DECLARATION, CONTRACT_APPROVAL, BANKING, CHARTER_AMENDMENT, BYLAW_AMENDMENT, MERGER_ACQUISITION, DISSOLUTION, COMMITTEE_ACTION, COMPENSATION, AUDIT, GENERAL, OTHER]
        resolvedText:
          type: string

    ShareholderMeetingRequest:
      type: object
      required: [privateKey, entityId, action]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        action:
          type: string
          enum: [call, open, close, record_attendance]
        meetingType:
          type: string
          enum: [ANNUAL, SPECIAL, CONSENT]
        scheduledDate:
          type: string
        recordDate:
          type: string
        agenda:
          type: array
          items:
            type: string

    ProxyRequest:
      type: object
      required: [privateKey, entityId, action]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        action:
          type: string
          enum: [grant, revoke]
        proxyHolderId:
          type: string
          format: uuid
        shares:
          type: integer
        scope:
          type: string
          enum: [GENERAL, MEETING_SPECIFIC, LIMITED]

    AppointOfficerRequest:
      type: object
      required: [privateKey, entityId, title, name, resolutionRef]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        title:
          type: string
          enum: [CEO, CFO, COO, CTO, Secretary, Treasurer, President, Vice_President, General_Counsel]
        name:
          type: string
        email:
          type: string
          format: email
        resolutionRef:
          type: string
          format: uuid
        startDate:
          type: string

    IssueSecuritiesRequest:
      type: object
      required: [privateKey, entityId, className, shares, recipient, resolutionRef]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        className:
          type: string
        shares:
          type: integer
        pricePerShare:
          type: number
        recipient:
          type: object
          required: [name, type]
          properties:
            name:
              type: string
            type:
              type: string
              enum: [individual, entity]
            address:
              type: string
        resolutionRef:
          type: string
          format: uuid
        restrictionType:
          type: string
          enum: [NONE, RULE_144, LOCK_UP, TRANSFER_RESTRICTION]

    TransferSecuritiesRequest:
      type: object
      required: [privateKey, entityId, fromHolderId, toRecipient, className, shares]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        fromHolderId:
          type: string
          format: uuid
        toRecipient:
          type: object
          required: [name, type]
          properties:
            name:
              type: string
            type:
              type: string
        className:
          type: string
        shares:
          type: integer
        pricePerShare:
          type: number
        transferType:
          type: string
          enum: [SALE, GIFT, INHERITANCE, CONVERSION]

    FileComplianceRequest:
      type: object
      required: [privateKey, entityId, filingType, jurisdiction, dueDate]
      properties:
        privateKey:
          type: string
        entityId:
          type: string
          format: uuid
        filingType:
          type: string
          enum: [ANNUAL_REPORT, TAX_RETURN, BENEFICIAL_OWNERSHIP, SECURITIES_FILING, FOREIGN_QUALIFICATION, REGISTERED_AGENT_UPDATE, OTHER]
        jurisdiction:
          type: string
        dueDate:
          type: string
        filedDate:
          type: string
        documentRef:
          type: string

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              details:
                type: array
                items:
                  type: object
